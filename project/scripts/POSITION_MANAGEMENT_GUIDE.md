# 仓位管理和杠杆建议系统

## 📊 信号强度计算

### 计算公式

```
信号强度 = 金叉数量 - 死叉数量
```

### 统计范围

- **时间框架**: 5m, 15m, 30m, 1h, 4h, 1d (共6个)
- **技术指标**: 
  - KDJ 金叉/死叉
  - MACD 金叉/死叉
  - 每个时间框架有 2 个指标
- **最大信号数**: 6 × 2 = 12

### 信号强度范围

- **范围**: -12 到 +12
- **正数** = 看涨信号（金叉多于死叉）
- **负数** = 看跌信号（死叉多于金叉）
- **0** = 信号中性（金叉和死叉数量相等）

### 示例

- `信号强度 = +6`: 6个金叉，0个死叉 → 强烈看涨
- `信号强度 = -4`: 2个金叉，6个死叉 → 看跌
- `信号强度 = 0`: 金叉和死叉数量相等 → 中性

## 🎯 置信度计算

置信度基于多个因素综合计算（0-100%）：

1. **信号强度一致性** (30%权重)
   - 信号强度绝对值越大，一致性越高

2. **预测方向与信号方向一致性** (30%权重)
   - 预测涨跌方向与信号方向一致时更高

3. **ADX 趋势强度** (20%权重)
   - ADX > 25 表示强趋势

4. **RSI 位置** (10%权重)
   - RSI 在 30-70 之间更可靠

5. **预测幅度合理性** (10%权重)
   - 极端预测（>5%）可能不可靠

## 💰 仓位和杠杆建议

### 计算逻辑

仓位大小和杠杆率基于以下因素：

1. **信号强度因子** (40%权重)
   ```
   信号强度因子 = |信号强度| / 12
   ```

2. **置信度因子** (40%权重)
   ```
   置信度因子 = 置信度 / 100
   ```

3. **预测幅度因子** (20%权重)
   - 预测幅度 < 5%: 因子 = 1.0
   - 预测幅度 > 5%: 因子递减（极端预测降低仓位）

4. **综合风险评分**
   ```
   风险评分 = 信号强度因子×0.4 + 置信度因子×0.4 + 预测幅度因子×0.2
   ```

### 风险等级配置

#### 保守 (Conservative)
- 仓位倍数: 0.5x（减半）
- 杠杆倍数: 0.6x（降低）
- 最低置信度: 60%
- 最低信号强度: 3

#### 中等 (Moderate) - 默认
- 仓位倍数: 1.0x
- 杠杆倍数: 1.0x
- 最低置信度: 40%
- 最低信号强度: 2

#### 激进 (Aggressive)
- 仓位倍数: 1.5x（增加）
- 杠杆倍数: 1.2x（提高）
- 最低置信度: 30%
- 最低信号强度: 1

### 建议等级

- **强烈建议** (风险评分 ≥ 70%): 建议较大仓位
- **中等建议** (风险评分 50-70%): 建议中等仓位
- **谨慎建议** (风险评分 < 50%): 建议小仓位
- **不建议交易**: 不满足最低要求

## 📋 使用示例

### 示例 1: 强信号

```
信号强度: +8
置信度: 75%
预测涨跌: +1.5%
风险等级: moderate

结果:
- 风险评分: 85/100
- 建议仓位: 85%
- 建议杠杆: 8.5x
- 建议等级: 强烈建议
```

### 示例 2: 弱信号

```
信号强度: -1
置信度: 35%
预测涨跌: -0.4%
风险等级: moderate

结果:
- 风险评分: 25/100
- 建议仓位: 0% (不满足最低要求)
- 建议等级: 不建议交易
原因: 信号强度不足 (1.0 < 2)
```

### 示例 3: 中等信号

```
信号强度: +4
置信度: 55%
预测涨跌: +1.2%
风险等级: moderate

结果:
- 风险评分: 62/100
- 建议仓位: 62%
- 建议杠杆: 6.2x
- 建议等级: 中等建议
```

## 🔧 配置风险等级

### 命令行参数

```bash
python3 prediction_server.py \
    --model ../models/regression_model_xxx.pkl \
    --risk-level conservative  # 或 moderate, aggressive
```

### 默认配置

如果不指定，默认使用 `moderate` 风险等级。

## ⚠️ 风险提示

1. **仅供参考**: 仓位建议仅供参考，不构成投资建议
2. **风险自担**: 请根据自身风险承受能力调整
3. **动态调整**: 市场条件变化时，建议会相应调整
4. **止损设置**: 建议设置止损，控制风险
5. **资金管理**: 不要将所有资金投入单一交易

## 📊 报告示例

```
📉 交易建议: 🟡 中等建议

💰 建议仓位: 45.2%
⚡ 建议杠杆: 4.5x
📊 风险评分: 45/100

详细分析:
• 信号强度因子: 33%
• 置信度因子: 57%
• 预测幅度因子: 100%

风险等级: 中等
说明: 信号和置信度中等，建议中等仓位
```

## 🔍 如何解读

1. **信号强度**: 反映多周期技术指标的一致性
   - 越高 = 多个时间框架信号一致
   - 越低 = 信号分散或冲突

2. **置信度**: 反映预测的可靠性
   - 越高 = 预测越可靠
   - 越低 = 预测不确定性高

3. **风险评分**: 综合评估
   - ≥ 70: 强信号，可考虑较大仓位
   - 50-70: 中等信号，适中仓位
   - < 50: 弱信号，小仓位或观望

4. **建议仓位**: 基于风险评分的仓位大小
   - 0-100%，根据风险评分动态调整

5. **建议杠杆**: 基于风险评分的杠杆倍数
   - 1x - 10x（可配置），风险越高杠杆越低

